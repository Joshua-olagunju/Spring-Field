<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Test Reports API</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 20px;
            }
            .result {
                background: #f5f5f5;
                padding: 20px;
                margin: 20px 0;
                border-radius: 5px;
                white-space: pre-wrap;
                word-wrap: break-word;
            }
            .error {
                background: #ffebee;
                color: #c62828;
            }
            .success {
                background: #e8f5e8;
                color: #2e7d32;
            }
            button {
                background: #2196f3;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 5px;
                cursor: pointer;
                margin: 5px;
            }
            button:hover {
                background: #1976d2;
            }
            input {
                padding: 8px;
                border: 1px solid #ddd;
                border-radius: 3px;
                width: 300px;
                margin: 5px;
            }
        </style>
    </head>
    <body>
        <h1>Test SpringField Reports API</h1>

        <div>
            <label>Auth Token (Bearer):</label><br />
            <input
                type="text"
                id="authToken"
                placeholder="Enter your auth token here..."
            />
        </div>

        <div>
            <button onclick="testStatistics()">Test Statistics API</button>
            <button onclick="testUserAnalytics()">Test User Analytics</button>
            <button onclick="testVisitorAnalytics()">
                Test Visitor Analytics
            </button>
            <button
                onclick="testStatisticsNoAuth()"
                style="background: #ff9800"
            >
                Test Statistics (No Auth)
            </button>
        </div>

        <div id="result" class="result">Results will appear here...</div>

        <script>
            const baseUrl = "http://localhost:8000/api";

            function getAuthToken() {
                return document.getElementById("authToken").value.trim();
            }

            function displayResult(data, isError = false) {
                const resultDiv = document.getElementById("result");
                resultDiv.className = `result ${isError ? "error" : "success"}`;
                resultDiv.textContent = JSON.stringify(data, null, 2);
            }

            async function makeRequest(endpoint) {
                const token = getAuthToken();

                if (!token) {
                    displayResult(
                        { error: "Please enter an auth token first" },
                        true
                    );
                    return;
                }

                try {
                    const response = await fetch(`${baseUrl}${endpoint}`, {
                        method: "GET",
                        headers: {
                            "Content-Type": "application/json",
                            Authorization: `Bearer ${token}`,
                        },
                    });

                    const data = await response.json();

                    if (response.ok) {
                        displayResult(data, false);
                    } else {
                        displayResult(
                            {
                                error: "API Error",
                                status: response.status,
                                message: data.message || "Unknown error",
                                data: data,
                            },
                            true
                        );
                    }
                } catch (error) {
                    displayResult(
                        {
                            error: "Network Error",
                            message: error.message,
                        },
                        true
                    );
                }
            }

            function testStatistics() {
                makeRequest("/reports/statistics");
            }

            function testUserAnalytics() {
                makeRequest("/reports/user-analytics");
            }

            function testVisitorAnalytics() {
                makeRequest("/reports/visitor-analytics");
            }

            async function testStatisticsNoAuth() {
                try {
                    const response = await fetch(
                        `${baseUrl}/test-reports-statistics`,
                        {
                            method: "GET",
                            headers: {
                                "Content-Type": "application/json",
                            },
                        }
                    );

                    const data = await response.json();

                    if (response.ok) {
                        displayResult(data, false);
                    } else {
                        displayResult(
                            {
                                error: "API Error",
                                status: response.status,
                                message: data.message || "Unknown error",
                                data: data,
                            },
                            true
                        );
                    }
                } catch (error) {
                    displayResult(
                        {
                            error: "Network Error",
                            message: error.message,
                        },
                        true
                    );
                }
            }
        </script>
    </body>
</html>
